{% extends 'forecaster/base.html' %} {# Inherit base structure and styles #}

{% block main_title %}Instant FX Forecaster{% endblock %} {# Set the main centered title #}
{% block title %}Instant FX Forecast{% endblock %} {# Set the browser tab title #}

{% block content %}
    <h2>Instant Future FX Rates</h2>
    <!-- <p>Select currencies below. Results are generated quickly using pre-trained models.</p> -->
    <p>Future FX Rates are generated quickly using pre-trained models.</p>

    {# --- FORM CONTAINER (Two Columns) --- #}
    <div class="form-container">

        {# --- LEFT COLUMN (Inputs & Button) --- #}
        <div class="form-left">
            <form method="post">
                {% csrf_token %}

                <div class="form-group">
                    <label for="from_currency">From Currency:</label>
                    <select name="from_currency" id="from_currency">
                        {% for currency in currencies %}
                            <option value="{{ currency }}" {% if currency == from_currency %}selected{% endif %}>
                                {{ currency }}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="to_currency">To Currency:</label>
                    <select name="to_currency" id="to_currency">
                        {% for currency in currencies %}
                            <option value="{{ currency }}" {% if currency == to_currency %}selected{% endif %}>
                                {{ currency }}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <button type="submit" class="submit-button">Generate Instant Forecast</button>
            </form>
        </div> {# --- End Left Column --- #}

        {# --- RIGHT COLUMN (Switch Box) --- #}
        <div class="form-right">
            <div class="switch-box">
                <p>Want a forecast based on live training with the absolute latest data (slower)?</p>
                <a href="{% url 'forecaster:forecast_page' %}" class="switch-button live">‚è≥ Go to Live Training Forecast</a>
            </div>
        </div> {# --- End Right Column --- #}

    </div> {# --- End Form Container --- #}


    {# --- Display Error Messages (if any) --- #}
    {% if error_message %}
        <div class="error">
            <strong>Error:</strong> {{ error_message }}
        </div>
    {% endif %}

    {# --- Display Execution Time (if available) --- #}
    {% if execution_time %}
        <p style="font-style: italic; color: #555;">Instant forecast generated in {{ execution_time }} seconds.</p>
    {% endif %}

    {# --- Display Results Section --- #}
    {% if forecast_data is not None %}
        <div class="results">
            <!-- <h2>30-Day Forecast for {{ from_currency }}/{{ to_currency }} (Pre-Trained Model)</h2> -->
            <h2>30-Day Exchange Rate Forecast for {{ from_currency }}/{{ to_currency }}</h2>
            {% if chart_html %}
                <div class="chart">
                    <p>Displaying interactive forecast chart:</p>
                    {{ chart_html|safe }}
                </div>
            {% else %}
                <p class="error">Could not generate chart.</p>
            {% endif %}
            <!-- <h2>Forecast Data</h2> -->
            <h2>Estimated Future Exchange Rates</h2>
            <table>
                <thead>
                    <tr><th>Date</th><th>Forecasted Rate</th></tr>
                </thead>
                <tbody>
                    {% for date, row in forecast_data.iterrows %}
                    <tr>
                        <td>{{ date|date:"Y-m-d" }}</td>
                        <td>{{ row.Forecast|floatformat:5 }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% elif request.method == 'POST' and not error_message %}
         <p>Processing forecast...</p> {# Should be very brief #}
    {% elif request.method == 'GET' %}
        <p style="margin-top: 20px;">Please select currencies and click 'Generate Instant Forecast'.</p>
    {% endif %}

{% endblock %}